---
title: "Q5"
author: "Arindom Baruah (32779267)"
execute: 
  echo: true
  message: false
  warning: false
format: html
number-sections: true
theme: journal
---


```{r}
#| echo: false
#| message: false
#| fig-width: 10
#| fig-height: 5
library(palmerpenguins)
library(colorspace)
library(patchwork)
library(tidyr)
library(dplyr)
library(ggplot2)
library(kableExtra)
library(nullabor)
```


# Data pre-processing

Let us check how the initial dataset looks like. @tbl-peng gives us a short glimpse of the dataset.

```{r}
#| label: tbl-peng
#| tbl-cap: "Penguin dataset from the Palmerpenguins package"
head(penguins) %>% kable %>% 
  kable_styling(bootstrap_options = c("bordered","hover"))
```

For further analysis, we will retain only the following variables and rename them as follows:

1. Species
2. Bill_length (Renamed as bl)
3. Bill_depth (Renamed as bd)
4. Flipper_length (Renamed as fl)
5. Body_mass_g (Renamed as bm)

We will additionally remove any missing values in the dataset.

```{r}

vars <- c("species","bill_length_mm",
          "bill_depth_mm","flipper_length_mm",
          "body_mass_g")
penguins_subset <- penguins %>% drop_na() %>% select(vars)
penguins_subset <- penguins_subset %>% rename("bl" = "bill_length_mm",
                                              "bd" = "bill_depth_mm",
                                              "fl" = "flipper_length_mm",
                                              "bm" = "body_mass_g")
```

The new pre-processed dataset is illustrated through @tbl-pengsub

```{r}
#| label: tbl-pengsub
#| tbl-cap: "Pre-processed dataset"

head(penguins_subset) %>% kable %>% 
  kable_styling(bootstrap_options = c("bordered","hover"))

```


# Plot visualisation of bm and bl

```{r}
#| label: fig-charts
#| fig-cap: "Body mass Vs Flipper length"
#| fig-subcap: 
#|   - "General plot for bm and fl"
#|   - "Variation across species"
#| layout-ncol: 2
pl1 <- ggplot(data = penguins_subset,aes(x = bm,y = fl)) + 
  geom_point() + labs(x = "Body mass (bm)",y = "Flipper length (fl)") + theme_classic() + theme(aspect.ratio=1)

pl2 <- ggplot(data = penguins_subset,aes(x = bm,y = fl)) + 
  geom_point(aes(color = species)) + labs(x = "Body mass (bm)",y = "Flipper length (fl)",color = "Species") + 
  theme_classic() + scale_color_discrete_divergingx(palette="Zissou 1") 
pl1
pl2
```

The plots illustrated by @fig-charts show the relation between fl and bm across different species.

# Lineup of 20 plots 

## Plot A

Let us create the null plots for plot (a) in @fig-charts by permuting the body mass (bm) as shown by the code chunks below.

```{r}
#| label: fig-nulla
#| fig-cap: "Null plots for bm vs fl"
set.seed(201349)
ggplot(lineup(null_permute('bm'), penguins_subset), aes(x = bm, y = fl),n =20) +
  geom_point() +
  facet_wrap(~ .sample) +
  theme(axis.text=element_blank(),
        axis.title=element_blank())
```
@fig-nulla illustrates the null plots for data points __generated by permuting the value of body mass (bm)__.

<div class="alert alert-block alert-warning">
ðŸ’¡

The null hypothesis and the alternative hypothesis are as follows:

$H_o$ = The variables body mass (bm) and flipper length (fl) have __no association with one another.__
$H_1$ = Body mass (bm) and flipper length(fl) are related to each other.

Method : Permutation of the body mass (bm) variable.
ðŸ’¡
</div>


## Plot B

Let us now create the null plots for the same variables fl and bm but add in a level of colors for different species as illustrated by @fig-nullb. We are going to __randomly permute the species of the penguins__ to test whether the variables of fl and bm have any correlation with species.

```{r}
#| label: fig-nullb
#| fig-cap: "Null plots for bm vs fl colored by different species"

set.seed(201344)
ggplot(lineup(null_permute("species"), penguins_subset, n=20),
       aes(x=bm, y=fl, colour=species)) +
  geom_point(alpha=0.7) +
  facet_wrap(~.sample, ncol=5) +
  colorspace::scale_color_discrete_divergingx(palette="Temps") +
  theme_bw() +
  theme(
    legend.position="none",
    axis.title = element_blank(),
    axis.text = element_blank()
  )
```


<div class="alert alert-block alert-warning">
ðŸ’¡

The null hypothesis and the alternative hypothesis are as follows:

$H_o$ = The variables body mass (bm) and flipper length (fl) have __no association with the type of penguin species.__
$H_1$ = Body mass (bm) and flipper length(fl) are related are dependent upon the particular type of species.

Method : Permutation of the species variable.
ðŸ’¡
</div>


# P-value calculation 

## Plot A

Based on the reports of 8 cases, following observations were recorded:

A total of 7 of the 8 observations recorded that they observed plot 3 to be the most unique plot in the lineup while one observation recorded plot 14 as a unique plot.

Some of the reasons outlined for those who chose plot 3 are follows:

- Less noise in the data.
- Looks like a linear relationship.
- Less variation in the data.
- Less spread out data compared to the rest of the plots.

One subject however chose plot 14 and the reason was attributed to the extreme presence of outlier values which is not the case for the rest of the plots.


Based on the above statistics, the P-value maybe calculated through the code-chunk below.


```{r pcalca}

p_val <- sum(dbinom(7:8,8,1/20))

```


<div class="alert alert-block alert-warning">
ðŸ’¡

Based on the statistics observed by the reports of the 8 test subjects, the P-value of 7 or more people choosing plot 3 as the most unique plot in the line up is __`r p_val`__. Such a low score indicates that there is overwhelming evidence to reject the null hypothesis in favor of the alternate hypothesis __which states that the variables of body mass (bm) and flipper length (fl) are indeed related to each other__.
ðŸ’¡
</div>


## Plot B

Based on the reports of 8 cases, following observations were recorded:

All of the 8 observations recorded that they observed plot 10 to be the most unique plot in the lineup.

Some of the reasons outlined for those who chose plot 10 are as follows:

- Clear band of 3 different colors observed.
- Less intermixing of the different colors.
- A definitive pattern in the colors observed.
- Concentration of red color observed at the top end.




```{r pcalcb}

p_val <- sum(dbinom(8:8,8,1/20))

```


<div class="alert alert-block alert-warning">
ðŸ’¡

Based on the statistics observed by the reports of the 8 test subjects, the P-value of 8 choosing plot 10 as the most unique plot in the line up is __`r p_val`__. Such a low score indicates that there is overwhelming evidence to reject the null hypothesis in favor of the alternate hypothesis __which states that the variables of body mass (bm) and flipper length (fl) are indeed related to the type of penguin species__.
ðŸ’¡
</div>
